/*! Leo  grunt @  2016-38-24 17:06:10 */
define("activity",["vue","./base","./getQueryString","./countdown","./popup","./infinite","./bind_data","./date","./set_heart","./comment"],function(a,b,c){a("vue");var d=a("./base"),e=a("./getQueryString"),f=(a("./countdown"),a("./infinite")),g=a("./bind_data"),h=a("./set_heart"),i=a("./comment"),j=a("./popup"),k={addHandler:function(a,b,c){a.addEventListener?a.addEventListener(b,c,!1):a.attachEvent?a.attachEvent("on"+b,c):a["on"+b]=c}};k.addHandler(applicationCache,"updateready",function(){applicationCache.update(),applicationCache.swapCache(),location.reload()}),$(function(){var a=e.getQueryString("ACTIVITY_ID"),b=e.getQueryString("MEMBER_ID");d.params.ACTIVITY_ID=a,d.params.MEMBER_ID=b,d.browser.versions.android?d.params.PHONE_TYPE="android":d.browser.versions.iPhone?d.params.PHONE_TYPE="iPhone":d.browser.versions.iPad?d.params.PHONE_TYPE="iPad":d.params.PHONE_TYPE="other",$(document).on("pageInit",".page",function(a,b,c){g.initPageData(),$(c).on("infinite",".infinite-scroll",function(){f.set()}),$(c).on("refresh",".pull-to-refresh-content",function(a){g.getPageData(),setTimeout(function(){$.pullToRefreshDone(".pull-to-refresh-content")},1e3)}),$(".content").scroll(function(){$(".jidan, .jinbi").remove();$(this).scrollTop();$(".tabs").offset().top<40?($(".buttons-tab").addClass("floating").appendTo("body"),$(".tabs").css("margin-top","40px")):($(".tv-info").after($(".buttons-tab").removeClass("floating")),$(".tabs").css("margin-top","0"))}),$("#activeHeart").on("click",function(){h.setActiveHeart()}),i.init(),$("#tab1").one("click",".item-after .fa",function(){h.setCommentHeart($(this).closest(".item-content"))}),$("#tab2").on("click",".item-link",function(){try{var a=d.vModel.$get("goods")[parseInt($(this).data("index"))];d.goToDetail({POP_TYPE:2,ID:a.SIMILAR_ID})}catch(b){}}),$(".pop>.content-block>.close").on("click",function(){j.close()}),g.autoData(),window.autoRefreshDataInterval=window.setInterval(function(){g.autoData()},1e4),$(".page").on("click",".on-top .article-detail",function(){d.goToDetail({POP_TYPE:$(this).attr("data-type"),ID:$(this).attr("id")})})}),$.init()})}),define("base",[],function(a,b,c){c.exports={uri:{base_data:"app/redis/activity/interaction",ping_lun:"app/forum/listForumByActivity",hosts_forum:"app/forum/hostsForum",tong_kuan:"app/similar/listByActivity",is_support:"app/similar/is_support",autoData:"app/activity/activityData",comment:"app/forum/save",activity_attention:"app/redis/activity/is_atten",comment_praise:"app/redis/forum/praiseForum",praise_or_fine:"app/activity/PraiseOrFine",submitAnswer:"app/questionnaire/submitAnswer",addAcceptRecord:"app/received_records/save",host:"http://highsheng.com:8080/t2o/"},params:{ACTIVITY_ID:"",MEMBER_ID:"",ATTENTION_ID:"",ONLINE_ID:"",PHONE_TYPE:"iphone",TV_SHOW_ID:"",COMMENT_TYPE:2,COMMENT_PARENT:0,TO:"",AT:{},INPUTMSG:"",currentPageHosts:0,currentPageComments:0,currentPageGoods:0,showCount:10},vars:{$audios:$("#audios"),msgAudio:$(".msg",this.$audios)[0],shangAudio:$(".shang",this.$audios)[0],zhaAudio:$(".zha",this.$audios)[0],loading:!1,curTab:"tab1",autoRefreshDataAjax:null,countdownTimeInterval:null,LASTDATE:"",TOTAL_VALUE:1e3,OPPOSE_VALUE:0,SUPPORT_VALUE:0,PROPS_SCORE:10},initCloseData:function(){$.closeModal(".pop"),this.vPop.IS_WHOLE=0,this.vPop.POP_TYPE=0,this.vPop.END_TIME=0,this.vPop.ID="",this.vPop.PUBLISH_IMG="",this.vPop.TITLE="",this.vPop.SUBJECT="",this.vPop.PRICE="",this.vPop.ABOUT="",this.vPop.LINK_ADDRESS="",this.vPop.BTN_NOTE="查看详情",this.vPop.RED_TOTAL_AMOUNT=0,this.vPop.RED_COUNT=0,this.vPop.RED_PER_AMOUNT_MAX=0,this.vPop.showImg=!0,this.vPop.showTitle=!0,this.vPop.showSubject=!0,this.vPop.showPrice=!1,this.vPop.showAbout=!0,this.vPop.showBtn=!0,this.vPop.showAnswer=!1,this.vPop.showRed=!1,this.vPop.autoClose=!1,this.vPop.isPopup=!1},getUrl:function(a){return this.uri.host+this.uri[a]},goToDetail:function(a){switch(parseInt(a.POP_TYPE)){case 1:this.browser.versions.ios?window.location.href=this.uri.host+"tkorzx//:PushTongkuanOrZixun:/"+a.POP_TYPE+"/"+a.ID:window.location.href=this.uri.host+"app/article/info?ARTICLE_ID="+a.ID+"&MEMBER_ID="+a.MEMBER_ID+"&PHONE_TYPE="+a.PHONE_TYPE;break;case 2:this.browser.versions.ios?window.location.href=this.uri.host+"tkorzx//:PushTongkuanOrZixun:/"+a.POP_TYPE+"/"+a.ID:window.location.href=this.uri.host+"app/similar/info?SIMILAR_ID="+a.ID+"&MEMBER_ID="+a.MEMBER_ID+"&PHONE_TYPE="+a.PHONE_TYPE}this.initCloseData()},browser:{versions:function(){var a=navigator.userAgent;navigator.appVersion;return{trident:a.indexOf("Trident")>-1,presto:a.indexOf("Presto")>-1,webKit:a.indexOf("AppleWebKit")>-1,gecko:a.indexOf("Gecko")>-1&&-1==a.indexOf("KHTML"),mobile:!!a.match(/AppleWebKit.*Mobile.*/),ios:!!a.match(/\(i[^;]+;( U;)? CPU.+Mac OS X/),android:a.indexOf("Android")>-1||a.indexOf("Linux")>-1,iPhone:a.indexOf("iPhone")>-1,iPad:a.indexOf("iPad")>-1,webApp:-1==a.indexOf("Safari")}}(),language:(navigator.browserLanguage||navigator.language).toLowerCase()},unique:function(a){for(var b=[],c={},d=0;d<a.length;d++){var e=a[d],f=typeof e+e;c[f]||(b.push(e),c[f]=1)}return b},isLogin:function(){return id=this.params.MEMBER_ID,""==id||"(null)"==id||"null"==id||null==id||void 0==id?(this.browser.versions.ios?window.location.href="Login://PushLogin/":Bridge.Login(),!1):!0},setMemberId:function(a){this.params.MEMBER_ID=a},vModel:new Vue({el:"#activePage",data:{gameURI:"",countdownTitle:"暂无活动",countdownTime:"",publishImgs:[],tvShowIcon:"./default.200x200.jpg",downProcess:"0%",upProcess:"0%",tvShowName:"",fans:"0",forums:"0",onlines:"0",isHeartActive:"fa-heart-o",placeholderMsg:"说两句吧",inputMsg:"",onTops:[],comments:[],hosts:[],searchKey:"",goods:[]},methods:{openImgLink:function(a){var b=$("img",a.target).data("type"),d=$("img",a.target).data("link");switch(b){case"1":window.location.href="http://123.57.172.249:8080/t2o/t2o/activity.html?ACTIVITY_ID="+d+"&MEMBER_ID="+base.params.MEMBER_ID;break;case"2":c.exports.goToDetail({POP_TYPE:2,ID:d});break;case"3":c.exports.goToDetail({POP_TYPE:1,ID:d});break;case"4":window.location.href=d}return!1}}}),vPopTemp:{showImg:!0,showTitle:!0,showSubject:!0,showPrice:!1,showAbout:!0,showBtn:!0,showAnswer:!1,showRed:!1,autoClose:!1,isPopup:!1,lastPoplayerID:null,IS_WHOLE:0,POP_TYPE:0,END_TIME:0,ID:"",PUBLISH_IMG:"",TITLE:"",SUBJECT:"",PRICE:"",ABOUT:"",LINK_ADDRESS:"",BTN_NOTE:"查看详情",RED_TOTAL_AMOUNT:0,RED_COUNT:0,RED_PER_AMOUNT_MAX:0,answers:[]},vPop:new Vue({el:"#pop",data:{showImg:!0,showTitle:!0,showSubject:!0,showPrice:!1,showAbout:!0,showBtn:!0,showAnswer:!1,showRed:!1,autoClose:!1,isPopup:!1,lastPoplayerID:null,IS_WHOLE:0,POP_TYPE:0,END_TIME:0,ID:"",PUBLISH_IMG:"",TITLE:"",SUBJECT:"",PRICE:"",ABOUT:"",LINK_ADDRESS:"",BTN_NOTE:"查看详情",RED_TOTAL_AMOUNT:0,RED_COUNT:0,RED_PER_AMOUNT_MAX:0,answers:[]}}),vMsgInfo:new Vue({el:"#msgInfo",data:{isShow:!1,ID:"",TYPE:"",SUB_TYPE:"",LINK_ID:"",SUB_LINK_ID:"",CONTENT:"",MEMBER_ID:"",TITLE:"新消息"}})}}),define("getQueryString",[],function(a,b,c){c.exports={getQueryString:function(a){var b=new RegExp("(^|&)"+a+"=([^&]*)(&|$)","i"),c=window.location.search.substr(1).match(b);return null!=c?unescape(c[2]):null}}}),define("countdown",["base","popup"],function(a,b,c){function d(a){return 10>a&&(a="0"+a),a}function e(a){var b=(a+"").split(":"),c=new Date,e=new Date(c.getFullYear(),c.getMonth(),c.getDate(),parseInt(b[0]),parseInt(b[1]),parseInt(b[2]));if(b.length<3)$("#countdownTime").html("");else{var i=e.getTime()-c.getTime(),j=Math.floor(i/36e5)%24,k=Math.floor(i/6e4)%60,l=Math.floor(i/1e3)%60;j=d(j),k=d(k),l=d(l),$("#countdownTime").html('<span class="h">'+j+'</span>:<span class="m">'+k+'</span>:<span class="s">'+l+"</span>"),(0>=i||"00"==j&&"00"==k&&"00"==l)&&(g.vars.countdownTimeInterval&&window.clearInterval(g.vars.countdownTimeInterval),g.vModel.countdownTitle="暂无活动",g.vModel.countdownTime="",$("#countdownTime").html(""),h.out(parseInt(g.vPopTemp.POP_TYPE),1),g.vPop.END_TIME&&f(g.vPop.END_TIME/1e3))}}function f(a){setTimeout(function(){g.vPop.autoClose&&h.close()},1e3*a)}var g=a("base"),h=a("popup");c.exports={set:e,close:f}}),define("popup",["base"],function(a,b,c){function d(a){$.ajax({type:"post",url:f.getUrl("addAcceptRecord"),data:{MEMBER_ID:f.params.MEMBER_ID,RELATED_ID:f.vPop.ID,TYPE:a},success:function(a){"000000"==a.state?($.toast("已为您保存到接收记录"),console.log("[leo]保存接受记录")):($.toast("接收记录保存失败"),console.log("[leo]接受记录保存失败"))}})}function e(){var a=$("#pop .goods-info-content input[type=radio]:checked").val();a?$.ajax({type:"post",url:f.getUrl("submitAnswer"),data:{MEMBER_ID:f.params.MEMBER_ID,QUESTION_ID:f.vPop.ID,ANSWERS:a},success:function(a){$.toast("提交成功"),b.close2()},error:function(a){$.toast("提交失败")}}):($.toast("请选择答案"),$(".pop").one("click",".control a",function(){e()}))}var f=a("base");b.out=function(a,b){f.vars.msgAudio.play(),f.vPop.POP_TYPE=a,f.vPop.ID=f.vPopTemp.ID;var c;switch(a){case 1:c=3.1,f.vPop.PUBLISH_IMG=f.vPopTemp.PUBLISH_IMG,f.vPop.TITLE=f.vPopTemp.TITLE,f.vPop.SUBJECT=f.vPopTemp.SUBJECT,f.vPop.ABOUT=f.vPopTemp.ABOUT,f.vPop.LINK_ADDRESS=f.vPopTemp.LINK_ADDRESS,f.vPop.BTN_NOTE=f.vPopTemp.BTN_NOTE,f.vPop.showImg=f.vPopTemp.showImg,f.vPop.showSubject=f.vPopTemp.showSubject,f.vPop.showAbout=f.vPopTemp.showAbout,f.vPop.showAnswer=f.vPopTemp.showAnswer;break;case 2:c=3.2,f.vPop.PUBLISH_IMG=f.vPopTemp.PUBLISH_IMG,f.vPop.TITLE=f.vPopTemp.TITLE,f.vPop.SUBJECT=f.vPopTemp.SUBJECT,f.vPop.ABOUT=f.vPopTemp.ABOUT,f.vPop.LINK_ADDRESS=f.vPopTemp.LINK_ADDRESS,f.vPop.PRICE=f.vPopTemp.PRICE,f.vPop.BTN_NOTE=f.vPopTemp.BTN_NOTE,f.vPop.showPrice=f.vPopTemp.showPrice,f.vPop.showImg=f.vPopTemp.showImg,f.vPop.showSubject=f.vPopTemp.showSubject,f.vPop.showAbout=f.vPopTemp.showAbout,f.vPop.showAnswer=f.vPopTemp.showAnswer;break;case 3:c=3.3,f.vPop.TITLE=f.vPopTemp.TITLE,f.vPop.$set("answers",f.vPopTemp.answers),f.vPop.BTN_NOTE=f.vPopTemp.BTN_NOTE,f.vPop.showImg=f.vPopTemp.showImg,f.vPop.showSubject=f.vPopTemp.showSubject,f.vPop.showPrice=f.vPopTemp.showPrice,f.vPop.showAbout=f.vPopTemp.showAbout,f.vPop.showAnswer=f.vPopTemp.showAnswer;break;case 4:c=3.4,f.vPop.RED_COUNT=f.vPopTemp.RED_COUNT,f.vPop.RED_PER_AMOUNT_MAX=f.vPopTemp.RED_PER_AMOUNT_MAX,f.vPop.RED_TOTAL_AMOUNT=f.vPopTemp.RED_TOTAL_AMOUNT;break;case 5:c=3.6,f.vPop.PUBLISH_IMG=f.vPopTemp.PUBLISH_IMG,f.vPop.ABOUT=f.vPopTemp.ABOUT,f.vPop.LINK_ADDRESS=f.vPopTemp.LINK_ADDRESS,f.vPop.BTN_NOTE=f.vPopTemp.BTN_NOTE,f.vPop.showSubject=f.vPopTemp.showSubject,f.vPop.showPrice=f.vPopTemp.showPrice,f.vPop.showPrice=f.vPopTemp.showPrice,f.vPop.showImg=f.vPopTemp.showImg,f.vPop.showSubject=f.vPopTemp.showSubject,f.vPop.showAbout=f.vPopTemp.showAbout,f.vPop.showAnswer=f.vPopTemp.showAnswer;break;case 6:}if($.popup(".pop"),b&&3!=a&&d(c),1==f.vPop.$get("POP_TYPE")||2==f.vPop.$get("POP_TYPE")){var g=function(){f.goToDetail({POP_TYPE:f.vPop.$get("POP_TYPE"),ID:f.vPop.$get("ID")})};$(".pop").one("click",".control a",function(){return f.isLogin()?void g():void $(".pop").one("click",".control a",function(){g()})})}else 3==f.vPop.$get("POP_TYPE")?$(".pop").one("click",".control a",function(){e()}):5==f.vPop.$get("POP_TYPE")&&(window.location.href=f.vPop.$get("LINK_ADDRESS"),$(".pop").one("click",".control a",function(){window.location.href=f.vPop.$get("LINK_ADDRESS")}))},b.close=function(a){a&&3==f.vPop.POP_TYPE&&d(3.3),f.initCloseData()},b.close2=function(){f.initCloseData()}}),define("infinite",["base","bind_data","countdown","popup","date"],function(a,b,c){function d(){e.vars.loading||(e.vars.loading=!0,f.addItems())}var e=a("base"),f=a("bind_data");b.set=d}),define("bind_data",["base","countdown","popup","date"],function(a,b,c){function d(){window.clearInterval(window.autoRefreshDataInterval),u.vars.autoRefreshDataAjax.abort()}function e(a){if(a.forum)for(var b=a.forum.length-1;b>=0;b--){var c=a.forum[b];if(c)if(c.PHOTO=c.PHOTO?/^http.*/.test(c.PHOTO)?c.PHOTO:u.uri.host+c.PHOTO:"./default.200x200.jpg",c.NICKNAME=c.NICKNAME?c.NICKNAME:c.MEMBER_NAME,c.COMMENTTIME=w.DateFormat(c.CREATE_DATE,"yyyy/MM/dd hh:mm")+" - "+c.PHONE_TYPE,"0"!=c.PARENT)u.vModel.comments.forEach(function(a){if(a.FORUM_ID==c.PARENT){a.childs?a.childs.push(c):a.childs=[c];for(var b=0;b<a.childs.length;b++)for(var d=b+1;d<a.childs.length;)a.childs[b].FORUM_ID==a.childs[d].FORUM_ID?a.childs.splice(d,1):d++}});else{u.vModel.comments.unshift(c);for(var d=0;d<u.vModel.comments.length;d++)for(var e=d+1;e<u.vModel.comments.length;)u.vModel.comments[d].FORUM_ID==u.vModel.comments[e].FORUM_ID?u.vModel.comments.splice(e,1):e++}}}function f(a){if(a.hosts)for(var b=a.hosts.length-1;b>=0;b--){var c=a.hosts[b];if(c){c.PHOTO=c.PHOTO?/^http.*/.test(c.PHOTO)?c.PHOTO:u.uri.host+c.PHOTO:"./default.200x200.jpg",c.NICKNAME=c.NICKNAME?c.NICKNAME:c.MEMBER_NAME,c.COMMENTTIME=w.DateFormat(c.CREATE_DATE,"yyyy/MM/dd hh:mm")+" - "+c.PHONE_TYPE,u.vModel.hosts.unshift(c);for(var d=0;d<u.vModel.hosts.length;d++)for(var e=d+1;e<u.vModel.hosts.length;)u.vModel.hosts[d].FORUM_ID==u.vModel.hosts[e].FORUM_ID?u.vModel.hosts.splice(e,1):e++}}}function g(){var a={};a.ACTIVITY_ID=u.params.ACTIVITY_ID,a.MEMBER_ID=u.params.MEMBER_ID,a.ONLINE_ID=u.params.ONLINE_ID;var b=new Date;u.vars.LASTDATE?a.LASTDATE=u.vars.LASTDATE:a.LASTDATE=u.vars.LASTDATE=b.getFullYear()+"-"+(b.getMonth()+1)+"-"+b.getDate()+" "+b.getHours()+":"+b.getMinutes()+":"+b.getSeconds(),u.vars.autoRefreshDataAjax=$.ajax({type:"get",url:u.getUrl("autoData"),data:a,async:!0,success:function(a){return u.vars.LASTDATE=b.getFullYear()+"-"+(b.getMonth()+1)+"-"+b.getDate()+" "+b.getHours()+":"+b.getMinutes()+":"+b.getSeconds(),a.result&&"idEmpty"==a.result?void $.toast("参数错误"):(e(a),f(a),u.vModel.comments.sort(function(a,b){var c=new Date(a.CREATE_DATE.replace(/\-/g,"/")),d=new Date(b.CREATE_DATE.replace(/\-/g,"/"));return d>c?1:c==d?0:-1}),a.poplayer&&h(a.poplayer),void(a.message&&a.message.length&&i(a.message)))}})}function h(a){if(a){if(u.vPop.lastPoplayerID==a.POPLAYER_ID)return;switch(u.vPop.isPopup=!1,u.vPopTemp.POP_TYPE=parseInt(a.POP_TYPE),u.vPop.lastPoplayerID=a.POPLAYER_ID,u.vPop.IS_WHOLE=a.IS_WHOLE,a.END_TIME&&(u.vPop.END_TIME=~~a.END_TIME,u.vPop.autoClose=!0),u.vPopTemp.POP_TYPE){case 1:u.vPopTemp.ID=a.article.ARTICLE_ID,u.vPopTemp.PUBLISH_IMG=u.uri.host+a.article.PUBLISH_IMG,u.vPopTemp.TITLE=a.article.TITLE,u.vPopTemp.SUBJECT=a.article.SUBJECT,u.vPopTemp.ABOUT=a.article.ABOUT,u.vPopTemp.LINK_ADDRESS=a.article.LINK_ADDRESS,u.vPopTemp.answers="",u.vPopTemp.BTN_NOTE="查看详情",u.vPopTemp.showImg=!0,u.vPopTemp.showSubject=!0,u.vPopTemp.showAbout=!0,u.vPopTemp.showAnswer=!1;break;case 2:u.vPopTemp.ID=a.similar.SIMILAR_ID,u.vPopTemp.PUBLISH_IMG=u.uri.host+a.similar.PUBLISH_IMG,u.vPopTemp.TITLE=a.similar.TITLE,u.vPopTemp.SUBJECT=a.similar.SUBJECT,u.vPopTemp.ABOUT=a.similar.ABOUT,u.vPopTemp.LINK_ADDRESS=a.similar.LINK_ADDRESS,u.vPopTemp.PRICE="1"==a.similar.IS_PROMOTE?a.similar.NEW_PRICE:a.similar.OLD_PRICE,u.vPopTemp.BTN_NOTE="立即购买",u.vPopTemp.answers="",u.vPopTemp.showPrice=!0,u.vPopTemp.showImg=!0,u.vPopTemp.showSubject=!0,u.vPopTemp.showAbout=!0,u.vPopTemp.showAnswer=!1;break;case 3:u.vPopTemp.ID=a.question.QUESTIONNAIRE_ID,u.vPopTemp.TITLE=a.question.QUESTION,u.vPopTemp.answers=a.question.answers,u.vPopTemp.BTN_NOTE="提交",u.vPopTemp.showImg=!1,u.vPopTemp.showSubject=!1,u.vPopTemp.showPrice=!1,u.vPopTemp.showAbout=!1,u.vPopTemp.showAnswer=!0;break;case 4:u.vPopTemp.ID=a.POPLAYER_ID,u.vPopTemp.RED_COUNT=a.RED_COUNT,u.vPopTemp.RED_PER_AMOUNT_MAX=a.RED_PER_AMOUNT_MAX,u.vPopTemp.RED_TOTAL_AMOUNT=a.RED_TOTAL_AMOUNT,u.vPopTemp.answers="";break;case 5:u.vPopTemp.ID=a.POPLAYER_ID,u.vPopTemp.PUBLISH_IMG=u.uri.host+a.LINK_IMG,u.vPopTemp.ABOUT=a.LINK_DESCRIPTION,u.vPopTemp.LINK_ADDRESS=a.LINK,u.vPopTemp.BTN_NOTE="查看详情",u.vPopTemp.answers="",u.vPopTemp.showSubject=!1,u.vPopTemp.showPrice=!1,u.vPopTemp.showImg=!0,u.vPopTemp.showAbout=!0,u.vPopTemp.showAnswer=!1;break;case 6:}u.vModel.countdownTime=a.TIME_POINT,u.vModel.countdownTitle="下一个活动时间",u.vars.countdownTimeInterval&&window.clearInterval(u.vars.countdownTimeInterval),u.vars.countdownTimeInterval=setInterval(function(){v.set(a.TIME_POINT)},1e3)}}function i(a){if(a&&a.length)try{u.vMsgInfo.isShow=!0,u.vMsgInfo.ID=a[0].HS_MESSAGE_ID,u.vMsgInfo.TYPE=a[0].TYPE,u.vMsgInfo.SUB_TYPE=a[0].SUB_TYPE,u.vMsgInfo.LINK_ID=a[0].LINK_ID,u.vMsgInfo.SUB_LINK_ID=a[0].SUB_LINK_ID,u.vMsgInfo.CONTENT=a[0].CONTENT,u.vMsgInfo.MEMBER_ID=a[0].MEMBER_ID,0==a[0].TYPE?u.vMsgInfo.TITLE="系统消息":1==a[0].TYPE&&"reply"==a[0].SUB_TYPE?u.vMsgInfo.TITLE="有人回复您":1==a[0].TYPE&&"at"==a[0].SUB_TYPE&&(u.vMsgInfo.TITLE="有人@您"),$("#msgInfo").one("click","em,span",function(){var a=40,b=null;b=u.vMsgInfo.SUB_LINK_ID?$('li[data-forumid="'+u.vMsgInfo.SUB_LINK_ID+'"]'):$('li[data-forumid="'+u.vMsgInfo.LINK_ID+'"]'),b&&b.length?(a=b.offset().top,$(".content").scrollTop(a),b.removeClass("warning").addClass("warning")):$(".content").scrollTop($(".content").height()),u.vMsgInfo.isShow=!1}),$("#msgInfo").one("click",".fa",function(){u.vMsgInfo.isShow=!1})}catch(b){}}function j(a){if(a.similar){for(var b=0,c=a.similar.length;c>b;b++){var d=a.similar[b];d.LIST_IMG=d.LIST_IMG?u.uri.host+d.LIST_IMG:"./default.200x200.jpg",d.NEW_PRICE="￥"+d.NEW_PRICE,d.OLD_PRICE="￥"+d.OLD_PRICE,u.vModel.goods.push(d)}for(var b=0;b<u.vModel.goods.length;b++)for(var e=b+1;e<u.vModel.goods.length;)u.vModel.goods[b].SIMILAR_ID==u.vModel.goods[e].SIMILAR_ID?u.vModel.goods.splice(e,1):e++}}function k(a){if(a.forum){a.forum.sort(function(a,b){var c=new Date(a.CREATE_DATE.replace(/\-/g,"/")),d=new Date(b.CREATE_DATE.replace(/\-/g,"/"));return d>c?1:c==d?0:-1});for(var b=0,c=a.forum.length;c>b;b++){var d=a.forum[b];if(d.PHOTO=d.PHOTO?/^http.*/.test(d.PHOTO)?d.PHOTO:u.uri.host+d.PHOTO:"./default.200x200.jpg",d.NICKNAME=d.NICKNAME?d.NICKNAME:d.MEMBER_NAME,d.COMMENTTIME=w.DateFormat(d.CREATE_DATE,"yyyy/MM/dd hh:mm")+" - "+d.PHONE_TYPE,d.childs)for(var e=0,f=d.childs.length;f>e;e++)d.childs[e].PHOTO=d.childs[e].PHOTO?/^http.*/.test(d.childs[e].PHOTO)?d.childs[e].PHOTO:u.uri.host+d.childs[e].PHOTO:"./default.200x200.jpg",d.childs[e].NICKNAME=d.childs[e].NICKNAME?d.childs[e].NICKNAME:d.childs[e].MEMBER_NAME,d.childs[e].COMMENTTIME=w.DateFormat(d.childs[e].CREATE_DATE,"yyyy/MM/dd hh:mm")+" - "+d.childs[e].PHONE_TYPE;u.vModel.comments.push(d)}}}function l(a){if(a.forum){a.forum.sort(function(a,b){var c=new Date(a.CREATE_DATE.replace(/\-/g,"/")),d=new Date(b.CREATE_DATE.replace(/\-/g,"/"));return d>c?1:c==d?0:-1});for(var b=0,c=a.forum.length;c>b;b++){var d=a.forum[b];d.PHOTO=d.PHOTO?/^http.*/.test(d.PHOTO)?d.PHOTO:u.uri.host+d.PHOTO:"./default.200x200.jpg",d.NICKNAME=d.NICKNAME?d.NICKNAME:d.MEMBER_NAME,d.COMMENTTIME=w.DateFormat(d.CREATE_DATE,"yyyy/MM/dd hh:mm")+" - "+d.PHONE_TYPE,u.vModel.hosts.push(d)}}}function m(){$.ajax({type:"post",url:u.getUrl("tong_kuan"),data:{TV_SHOW_ID:u.params.TV_SHOW_ID,showCount:u.params.showCount,currentPage:++u.params.currentPageGoods,KEY:u.vModel.searchKey},async:!0,success:function(a){return"error"==a.status?void $.toast(a.msg):(j(a),a.similar.length<parseInt(a.showCount)?(u.params.currentPageGoods=a.TotalPage,void $("#tab2 .infinite-scroll-preloader").remove()):(u.vars.loading=!1,$.refreshScroller(),void $.pullToRefreshDone(".pull-to-refresh-content")))}})}function n(){$.ajax({type:"get",url:u.getUrl("ping_lun"),data:{ACTIVITY_ID:u.params.ACTIVITY_ID,MEMBER_ID:u.params.MEMBER_ID,TYPE:2,showCount:u.params.showCount,currentPage:++u.params.currentPageComments},async:!0,success:function(a){return"error"==a.status?void $.toast(a.msg):(a.article&&u.vModel.$set("onTops",a.article),u.params.currentPageComments>a.totalPage?void $("#tab1 .infinite-scroll-preloader").remove():(k(a),u.vars.loading=!1,$.refreshScroller(),void $.pullToRefreshDone(".pull-to-refresh-content")))}})}function o(){$.ajax({type:"get",url:u.getUrl("hosts_forum"),data:{ACTIVITY_ID:u.params.ACTIVITY_ID,MEMBER_ID:u.params.MEMBER_ID,TYPE:2,showCount:u.params.showCount,currentPage:++u.params.currentPageHosts},async:!0,success:function(a){return"error"==a.status?void $.toast(a.msg):u.params.currentPageHosts>a.totalPage?void $("#tab3 .infinite-scroll-preloader").remove():(l(a),u.vars.loading=!1,$.refreshScroller(),void $.pullToRefreshDone(".pull-to-refresh-content"))}})}function p(){switch(u.vars.curTab=$(".buttons-tab").find(".active").attr("data-tab-id"),console.log("[leo]当前标签页=>",u.vars.curTab),u.vars.curTab){case"tab1":n();break;case"tab2":m();break;case"tab3":o()}}function q(){$.ajax({type:"get",url:u.getUrl("base_data"),data:{ACTIVITY_ID:u.params.ACTIVITY_ID,MEMBER_ID:u.params.MEMBER_ID,PHONE_TYPE:u.params.PHONE_TYPE},async:!1,success:function(a){if(a.result)switch(a.result){case"idEmpty":$.toast("获取活动信息失败");break;case"mIdEmpty":$.toast("获取用户信息失败")}else r(a)}})}function r(a){try{if($("body").data("ACTIVITY_ID",a.ACTIVITY_ID).data("MEMBER_ID",a.MEMBER_ID).data("ATTENTION_ID",a.ATTENTION_ID).data("TV_SHOW_ID",a.TV_SHOW_ID).data("END_TIME",a.END_TIME),$("title").html(a.TITLE),u.vars.TOTAL_VALUE=a.TOTAL_VALUE,u.vars.OPPOSE_VALUE=a.OPPOSE_VALUE,u.vars.SUPPORT_VALUE=a.SUPPORT_VALUE,u.params.ATTENTION_ID=a.ATTENTION_ID,u.params.TV_SHOW_ID=a.TV_SHOW_ID,u.params.ONLINE_ID=a.ONLINE_ID,u.vModel.$set("publishImgs",[]),a.imgList)for(var b=0,c=a.imgList.length;c>b;b++)u.vModel.publishImgs.push({FILE_PATH:1==a.imgList[b].MAKE_TYPE&&u.uri.host+a.imgList[b].FILE_PATH,TYPE:a.imgList[b].TYPE,LINK:a.imgList[b].LINK,MAKE_TYPE:a.imgList[b].MAKE_TYPE});else u.vModel.publishImgs.push({FILE_PATH:u.uri.host+a.PUBLISH_IMG,TYPE:"",LINK:"",MAKE_TYPE:1});Vue.nextTick(function(){new Swiper(".my-swiper",{speed:500,loop:!0,lazyLoading:!0,updateOnImagesReady:!0,pagination:".swiper-pagination",prevButton:".swiper-button-prev",nextButton:".swiper-button-next",effect:"cube",cube:{slideShadows:!1,shadow:!1}})}),u.vModel.tvShowIcon=u.uri.host+a.TV_LOGO,u.vModel.tvShowName=a.TV_NAME,u.vModel.fans=a.fansCount,u.vModel.forums=a.forums,u.vModel.onlines=a.onlines,u.vModel.isHeartActive=a.ATTENTION_ID?"fa-heart":"fa-heart-o",/^javascript/.test(a.URI)?u.vModel.gameURI=a.URI:u.vModel.gameURI=""==a.URI?"":a.URI+"?MEMBER_ID="+a.MEMBER_ID+"&LINK_ID="+a.ACTIVITY_ID}catch(d){}}function s(a){u.params.currentPageComments=0,u.vModel.$set("onTops",[]),u.vModel.$set("comments",[]),u.params.currentPageHosts=0,u.vModel.$set("hosts",[]),u.params.currentPageGoods=0,u.vModel.$set("goods",[]),n(),m(),o(),$("#tab2").on("blur","#search",function(){u.vModel.$set("goods",[]),m()}),$("#tab2").on("keypress","#search",function(){u.vModel.$set("goods",[]),m()})}function t(){q(),s()}var u=a("base"),v=a("countdown"),w=a("date");c.exports={autoData:g,initPageData:t,getPageData:s,addItems:p,stop:d}}),define("date",[],function(a,b,c){b.DateFormat=function(a,b){a=a.replace(/-/g,"/");var c=new Date(a),d={"M+":c.getMonth()+1,"d+":c.getDate(),"h+":c.getHours(),"m+":c.getMinutes(),"s+":c.getSeconds(),"q+":Math.floor((c.getMonth()+3)/3),S:c.getMilliseconds()};/(y+)/.test(b)&&(b=b.replace(RegExp.$1,(c.getFullYear()+"").substr(4-RegExp.$1.length)));for(var e in d)new RegExp("("+e+")").test(b)&&(b=b.replace(RegExp.$1,1==RegExp.$1.length?d[e]:("00"+d[e]).substr((""+d[e]).length)));return b},b.getLocalTime=function(a){return new Date(parseInt(a)).toLocaleString().replace(/:\d{1,2}$/," ")},b.getTimestamp=function(a){if(!/^\d{4}[-|\/|年]\d{1,2}[-|\/|月]\d{1,2}日?\s\d{1,2}:\d{1,2}(:\d{1,2})?$/.test(dateStr))return 0;var b=dateStr.replace(/[\/|年|月]/,"-").replace(/日/,"").split(/-|\:|\ /),a=new Date(b[0],b[1]-1,b[2],b[3],b[4],b[5]);return Date.parse(a)},b.getPreMonth=function(a){var b=a.split("-"),c=b[0],d=b[1],e=b[2],f=new Date(c,d,0);f=f.getDate();var g=c,h=parseInt(d)-1;0==h&&(g=parseInt(g)-1,h=12);var i=e,j=new Date(g,h,0);j=j.getDate(),i>j&&(i=j),10>h&&(h="0"+h);var k=g+"-"+h+"-"+i;return k},b.getNextMonth=function(a){var b=a.split("-"),c=b[0],d=b[1],e=b[2],f=new Date(c,d,0);f=f.getDate();var g=c,h=parseInt(d)+1;13==h&&(g=parseInt(g)+1,h=1);var i=e,j=new Date(g,h,0);j=j.getDate(),i>j&&(i=j),10>h&&(h="0"+h);var k=g+"-"+h+"-"+i;return k}}),define("set_heart",["base"],function(a,b,c){function d(){if(f.isLogin()){var a=$("#activeHeart"),b=a.find(".fa"),c={};c=b.hasClass("fa-heart")?{ATTENTION_ID:f.params.ATTENTION_ID,IS_DELETE:1}:{TV_SHOW_ID:f.params.TV_SHOW_ID,RELEVANT_ID:f.params.ACTIVITY_ID,MEMBER_ID:f.params.MEMBER_ID,TYPE:5,PARENT:0,IS_DELETE:0},f.vModel.isHeartActive=c.IS_DELETE?"fa-heart-o":"fa-heart",$.ajax({type:"post",url:f.getUrl("activity_attention"),data:c,async:!0,success:function(a){f.params.ATTENTION_ID=a.ATTENTION_ID}})}}function e(a){if(f.isLogin()){var b=a.find(".item-after .fa"),c={FORUM_ID:a.data("forumid")};b.hasClass("fa-heart")?(c.IS_DELETE=1,c.SUPPORT_ID=b.data("supportid")):(c.TYPE=3,c.PARENT=0,c.IS_DELETE=0,c.MEMBER_ID=f.params.MEMBER_ID);var d=parseInt(b.html());0==c.IS_DELETE?(b.removeClass("fa-heart-o").addClass("fa-heart"),b.html(isNaN(d)?b.html():++d)):(b.removeClass("fa-heart").addClass("fa-heart-o"),b.html(isNaN(d)?b.html():--d)),$.ajax({type:"post",url:f.getUrl("comment_praise"),data:c,async:!0,success:function(a){return $("#tab1").one("click",".item-after .fa",function(){e($(this).closest(".item-content"))}),/eo?rror/i.test(a.status)?void(a.msg?$.toast(a.msg):$.toast("参数错误")):void(a.SUPPORT_ID&&b.data("supportid",a.SUPPORT_ID))}})}}var f=a("base");c.exports={setActiveHeart:d,setCommentHeart:e}}),define("comment",["base","bind_data","countdown","popup","date"],function(a,b,c){function d(a){var b={COMMENTTIME:j.DateFormat(a.CREATE_DATE,"yyyy/MM/dd hh:mm")+" - "+a.PHONE_TYPE,CONTENT:a.CONTENT,CREATE_DATE:a.CREATE_DATE,FORUM_ID:a.FORUM_ID,MEMBER_ID:a.MEMBER_ID,MEMBER_NAME:a.MEMBER_NAME,NICKNAME:a.NICKNAME?a.NICKNAME:a.MEMBER_NAME,PARENT:a.PARENT,PHONE_TYPE:a.PHONE_TYPE,PHOTO:a.PHOTO?/^http.*/.test(a.PHOTO)?a.PHOTO:i.uri.host+a.PHOTO:"./default.200x200.jpg",SIGN:a.SIGN,SUPPORT:0,SUPPORT_ID:"",TV_SHOW_ID:a.TV_SHOW_ID};"0"!=a.PARENT?i.vModel.comments.forEach(function(c){c.FORUM_ID==a.PARENT&&(c.childs?c.childs.push(b):c.childs=[b])}):(b.childs=[],i.vModel.comments.unshift(b)),$.hideIndicator(),h(),$(".page").one("click",".searchbar-cancel",function(){e()})}function e(){if(i.isLogin()){if(/^\s*$/.test(i.vModel.inputMsg))return $.toast("您是不是忘记输入评论内容了"),void $(".page").one("click",".searchbar-cancel",function(){e()});$.showIndicator(),$.ajax({type:"post",url:i.getUrl("comment"),data:{TYPE:i.params.COMMENT_TYPE,PARENT:i.params.COMMENT_PARENT,MEMBER_ID:i.params.MEMBER_ID,PHONE_TYPE:i.params.PHONE_TYPE,TV_SHOW_ID:i.params.ACTIVITY_ID,TO:i.params.TO,CONTENT:f(i.params.AT),AT:g(i.params.AT)},async:!0,success:function(a){return"000000"!=a.state?void $.toast(a.msg||"评论失败"):void d(a)}})}}function f(a){return $.each(a,function(a,b){var c=new RegExp("(@"+b+"\\s)","gm");c.test(i.vModel.inputMsg)?i.params.INPUTMSG=i.vModel.inputMsg.replace(c,'<a href="javascript:void(0);" data-type="at" data-memberid="'+a+'" class="external">$1</a>'):delete i.params.AT[a]}),Object.keys(a).length?i.params.INPUTMSG:i.vModel.inputMsg}function g(a){var b="";return $.each(a,function(a,c){b+=a}),b}function h(){i.params.COMMENT_TYPE=2,i.params.COMMENT_PARENT=0,i.vModel.placeholderMsg="",i.params.INPUTMSG=i.vModel.inputMsg="",i.params.TO="",i.params.AT={}}var i=a("base"),j=(a("bind_data"),a("date")),k=$("#search");c.exports={init:function(){$(".page").one("click",".searchbar-cancel",function(){e()}),$("#tab1").on("click",".item-after span",function(){var a=$(this).closest(".item-content"),b=a.find(".item-title h3").html();i.params.COMMENT_TYPE=0,i.params.COMMENT_PARENT=a.data("forumid"),i.params.TO=a.data("memberid"),i.vModel.placeholderMsg="回复 "+b+":",$("#search").focus()}),$("#tab1").on("click",".item-title h3,.from",function(){var a=$(this).closest("li");i.params.AT[a.data("memberid")]=$(this).html(),i.vModel.inputMsg+=" @"+$(this).html()+" ",k.focus()}),k.on("blur",function(){/^\s*$/.test(i.vModel.inputMsg)&&h()})}}});